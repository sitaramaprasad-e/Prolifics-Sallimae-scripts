## ðŸ§  **Prompt: Generate DMN 1.4 Standard DRD from Markdown Rules (With Functional Grouping & Rule Relationship Mapping)**

You are a **Decision Modeling expert** specializing in **DMN 1.4**.

Your task is to generate a **Decision Requirements Diagram (DRD)** in **DMN-standard notation** using rules from a **Markdown (`.md`) file**. The DRD should follow **DMN best practices** with a **left-to-right flow**, include **interactive decision nodes** that display the **full DMN table**, ensure all XML special characters are escaped, include **styled tables**, and **preserve rule names exactly as they appear in the Markdown file**.

---

### **Objective**

* Produce a **DMN 1.4-compliant DRD** in **SVG format**.
* Use **only the rules provided in the Markdown file**.
* Keep **all rule names, IDs, and Decision Tables exactly as written**, escaping only XML special characters (`&, <, >, ', "`) to prevent SVG rendering issues.
* **Functional Grouping:** Intelligently categorize rules based on their **functional purpose, business domain, or operational area** to create logical clusters of related rules. The tool should use the context of the rules, inputs/outputs, and descriptions to perform this grouping.
* **Rule Relationship Mapping:** Analyze dependencies between grouped rules to understand **how different rule sets interact** and establish relationships between Decisions, Input Data, BKMs, and Knowledge Sources.
* Layout should follow **DMN best practices**: Inputs on the left, Decisions in the center, BKMs on the right, Knowledge Sources on top. Arrows flow left-to-right.
* **Interactive Feature:** Each Decision node should be clickable to display the **full DMN decision table**, including all rules and Code Block references.

---

### **Markdown Input Format**

```
### Rule Name: <Rule Title>
**Rule Purpose:** <purpose>
**Rule Spec:** <spec>
**Code Block:** <file reference>
**DMN:**
Inputs:
- input1: type
Outputs:
- output1: type

| condition | output |
|-----------|--------|
| ...       | ...    |
```

---

### **DMN Elements and Representation**

| Element                        | DMN Standard Shape                                      | Connector                               |
| ------------------------------ | ------------------------------------------------------- | --------------------------------------- |
| Decision                       | Rectangle with slightly rounded corners (`rx=5, ry=5`)  | Solid arrow for Information Requirement |
| Input Data                     | Fully rounded rectangle (`rx=ry=height/2`)              | Solid arrow to Decisions                |
| Business Knowledge Model (BKM) | Rectangle with top-right corner folded (dog-ear)        | Dashed arrow for Knowledge Requirement  |
| Knowledge Source               | Rectangle with folded top-right corner (document shape) | Dotted arrow for Authority Requirement  |

---

### **Interactive Feature (Full Table Display + XML-safe + Styled + Exact Rule Names)**

* Make each Decision node clickable.
* On click, display the DMN table for that Decision exactly as written in the Markdown.
* Preserve **rule names exactly as in the Markdown**, without trimming, changing case, or modifying any special characters.
* Escape only XML special characters (`&, <, >, ', "`) to prevent SVG errors.
* Render rule names inside `<pre>` or `<code>` tags in `<foreignObject>` to maintain exact formatting.
* Use `<foreignObject>` or toggleable `<g>` groups in SVG.
* Set default `<foreignObject>` width/height large enough for typical tables; enable scroll for overflow.
* Dynamically resize `<foreignObject>` if content is larger.
* Include table styling for readability: borders, padding, word-wrap, alternating row colors.
* Include Code Block reference as a tooltip or metadata.

---

### **Functional Grouping and Relationship Mapping**

* Automatically **group rules into functional clusters** based on purpose, domain, or operational area.
* Analyze **inputs, outputs, and DMN table logic** to map dependencies between clusters.
* Establish **relationships between Decisions** (Information/Knowledge/Authority Requirements) using DMN-standard arrows.

---

### **Deliverables**

1. **DRD Diagram (SVG or textual)**

   * Fully DMN 1.4-compliant
   * Left-to-right flow
   * Shows all Input Data, Decisions, BKMs, Knowledge Sources
   * Correct arrow types/directions
   * Interactive Decision nodes revealing full DMN tables with **exact rule names**, proper styling, XML-safe content
   * Functional clusters and mapped relationships automatically detected

2. **Optional structured DRD text**

   * Lists each Decision and its associated rules exactly as written

3. **Traceability Table (Markdown)**

   * Maps Business Decisions â†’ Rules â†’ Code Reference
   * Shows relationships/dependencies between grouped decisions

---

### **DMN Legend (For Bottom of DRD)**

| Symbol / Shape                                          | Meaning                        |
| ------------------------------------------------------- | ------------------------------ |
| Rectangle with rounded corners                          | Decision                       |
| Fully rounded rectangle                                 | Input Data                     |
| Rectangle with top-right folded corner (dog-ear)        | Business Knowledge Model (BKM) |
| Rectangle with folded top-right corner (document shape) | Knowledge Source               |
| Solid arrow                                             | Information Requirement        |
| Dashed arrow                                            | Knowledge Requirement          |
| Dotted arrow                                            | Authority Requirement          |

---

### **Start**

Generate the DRD once I provide the `.md` rules file. The DRD must follow **DMN-standard shapes, left-to-right layout, interactive Decision tables that fully display all rules, XML-safe rendering, styled tables, preserve rule names exactly as in the Markdown, and include functional grouping and rule relationship mapping**.
